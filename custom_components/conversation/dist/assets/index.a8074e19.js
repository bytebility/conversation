import{d as t,c as e,r as a,o as s,w as i,a as n,t as l,b as o,e as d,F as r,f as c,B as u,A as m,E as h,l as p,g,h as f,i as y,j as _,k as v,m as k,n as w}from"./vendor.2bd3f3a3.js";!function(t=".",e="__import__"){try{self[e]=new Function("u","return import(u)")}catch(a){const s=new URL(t,location),i=t=>{URL.revokeObjectURL(t.src),t.remove()};self[e]=t=>new Promise(((a,n)=>{const l=new URL(t,s);if(self[e].moduleMap[l])return a(self[e].moduleMap[l]);const o=new Blob([`import * as m from '${l}';`,`${e}.moduleMap['${l}']=m;`],{type:"text/javascript"}),d=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(o),onerror(){n(new Error(`Failed to import: ${t}`)),i(d)},onload(){a(self[e].moduleMap[l]),i(d)}});document.head.appendChild(d)})),self[e].moduleMap={}}}("assets/");const b=t({props:{data:{type:Object,default:()=>({cmd:"",text:""})}}}),x=n("a",null,"HomeAssistant",-1);b.render=function(t,o,d,r,c,u){const m=a("a-avatar"),h=a("a-comment"),p=a("a-card");return s(),e(p,{size:"small",title:t.data.cmd},{default:i((()=>[n(h,null,{author:i((()=>[x])),avatar:i((()=>[n(m,{src:"https://www.home-assistant.io/images/home-assistant-logo.svg",alt:"HomeAssistant"})])),content:i((()=>[n("p",null,l(t.data.text),1)])),_:1})])),_:1},8,["title"])};var M=t({props:{data:Object}});const C=o("第一集"),O=o("第二集"),j=o("第一集"),S=o("第一集"),U=o("第一集"),V=o("第一集"),$=o("第一集"),A=o("第一集");M.render=function(t,l,o,d,r,c){const u=a("a-card-grid"),m=a("a-card");return s(),e(m,{title:"我想看司藤",size:"small"},{default:i((()=>[n(m,{title:"获取所有状态值"},{default:i((()=>[n(u,{style:{width:"25%","text-align":"center"}},{default:i((()=>[C])),_:1}),n(u,{style:{width:"25%","text-align":"center"}},{default:i((()=>[O])),_:1}),n(u,{style:{width:"25%","text-align":"center"}},{default:i((()=>[j])),_:1}),n(u,{style:{width:"25%","text-align":"center"}},{default:i((()=>[S])),_:1}),n(u,{style:{width:"25%","text-align":"center"}},{default:i((()=>[U])),_:1}),n(u,{style:{width:"25%","text-align":"center"}},{default:i((()=>[V])),_:1}),n(u,{style:{width:"25%","text-align":"center"}},{default:i((()=>[$])),_:1}),n(u,{style:{width:"25%","text-align":"center"}},{default:i((()=>[A])),_:1})])),_:1})])),_:1})};var L=t({props:{data:{type:Object,default:()=>({cmd:"",text:"",list:[]})}},setup:()=>({checked:d(!1)})});L.render=function(t,d,u,m,h,p){const g=a("a-list-item"),f=a("a-list"),y=a("a-card");return s(),e(y,{title:t.data.cmd},{default:i((()=>[n(f,{bordered:""},{default:i((()=>[(s(!0),e(r,null,c(t.data.list,((t,a)=>(s(),e(g,{key:a},{actions:i((()=>[o(l(t.value),1)])),default:i((()=>[o(l(t.name)+" ",1)])),_:2},1024)))),128))])),_:1})])),_:1},8,["title"])};var R=t({props:{data:{type:Object,default:()=>({cmd:"",text:"",list:[]})},hass:{}},methods:{toggleClick(t){console.log(t),t.value="on"===t.value?"off":"on",this.hass.sendMessagePromise({type:"call_service",domain:t.domain,service:`turn_${t.value}`,service_data:{entity_id:t.entity_id}}).then((t=>{console.log(t)}))}}});const P={key:1};R.render=function(t,d,u,m,h,p){const g=a("a-switch"),f=a("a-list-item"),y=a("a-list"),_=a("a-card");return s(),e(_,{title:t.data.cmd},{default:i((()=>[n(y,{bordered:""},{default:i((()=>[(s(!0),e(r,null,c(t.data.list,((a,n)=>(s(),e(f,{key:n},{actions:i((()=>[0===n?(s(),e(g,{key:0,checked:"on"===a.value,onClick:e=>t.toggleClick(a)},null,8,["checked","onClick"])):(s(),e("span",P,l(a.value),1))])),default:i((()=>[o(l(a.name)+" ",1)])),_:2},1024)))),128))])),_:1})])),_:1},8,["title"])};var E=t({components:{BarsOutlined:u,AudioOutlined:m,CardAttributes:R,EditOutlined:h,CardMessage:b,CardVideo:M,CardState:L},setup:()=>({hass:null,list:d([]),isVoice:d(!1)}),data(){return{msg:"",throttle:p.throttle((()=>{this.sendMsg(this.msg)}),2e3,{leading:!1,trailing:!0})}},created(){this.connect()},methods:{async connect(){let t;try{t=await g({loadTokens(){try{return JSON.parse(localStorage.hassTokens)}catch(t){}},saveTokens:t=>{localStorage.hassTokens=JSON.stringify(t)}})}catch(a){if(a!==f)return void alert(`Unknown error: ${a}`);{const e=prompt("请输入要连接的HomeAssistant地址?",location.origin);t=await g({hassUrl:e})}}const e=await y({auth:t});location.search.includes("auth_callback=1")&&history.replaceState(null,"",location.pathname),this.hass=e,_(e).then((t=>{console.log("Logged in as",t),e.sendMessagePromise({type:"get_states"}).then((e=>{let a=e.find((t=>"conversation.voice"===t.entity_id)),s=new URLSearchParams(location.search),i=a.attributes.version;s.get("ver")!=i?location.search=`?ver=${i}`:this.list.push({name:"CardMessage",data:{cmd:"HomeAssistant服务连接成功",text:`【${t.name}】你好，欢迎使用语音小助手`}})}))}))},sendMsgKeydown(t){const{msg:e,isVoice:a}=this;if(e)return a?this.throttle():void(13===t.keyCode&&this.sendMsg(e))},sendMsg(t){this.msg="",this.hass.sendMessagePromise({conversation_id:`${Math.random().toString(16).substr(2,10)}${Math.random().toString(16).substr(2,10)}`,text:t,type:"conversation/process"}).then((({speech:e})=>{const a=e.plain.extra_data,s={cmd:t,text:e.plain.speech,list:[]};a?this.hass.sendMessagePromise({type:"get_states"}).then((t=>{const e=t.filter((t=>a.data.includes(t.entity_id))).map((t=>(t.domain=t.entity_id.split(".")[0],t)));if(1===e.length){const{attributes:t,state:a,domain:i,entity_id:n}=e[0];s.list=Object.keys(t).map((e=>({name:e,value:t[e]}))),s.list.unshift({domain:i,entity_id:n,name:t.friendly_name,value:a}),this.list.push({name:"CardAttributes",data:s})}else s.list=e.map((t=>({domain:t.domain,entity_id:t.entity_id,name:t.attributes.friendly_name,value:t.state}))),this.list.push({name:"CardState",data:s})})):this.list.push({name:"CardMessage",data:s})}))},toggleVoiceClick(){this.isVoice=!this.isVoice}}});const B={style:{position:"fixed",bottom:"0",left:"0",width:"100%",padding:"10px",background:"white"}};E.render=function(t,l,o,d,u,m){const h=a("BarsOutlined"),p=a("AudioOutlined"),g=a("EditOutlined"),f=a("a-tooltip"),y=a("a-input");return s(),e(r,null,[(s(!0),e(r,null,c(t.list,((a,i)=>(s(),e(v(a.name),{key:i,data:a.data,hass:t.hass},null,8,["data","hass"])))),128)),n("div",B,[n(y,{placeholder:"请输入文字命令",value:t.msg,"onUpdate:value":l[2]||(l[2]=e=>t.msg=e),onKeydown:l[3]||(l[3]=e=>t.sendMsgKeydown(e))},{prefix:i((()=>[n(h,{type:"user"})])),suffix:i((()=>[n(f,{title:t.isVoice?"自动发送":"手动发送"},{default:i((()=>[n("span",{onClick:l[1]||(l[1]=(...e)=>t.toggleVoiceClick&&t.toggleVoiceClick(...e))},[t.isVoice?(s(),e(p,{key:0,style:{color:"rgba(0, 0, 0, 0.45)"}})):(s(),e(g,{key:1,style:{color:"rgba(0, 0, 0, 0.45)"}}))])])),_:1},8,["title"])])),_:1},8,["value"])])],64)};k(E).use(w).mount("#app");

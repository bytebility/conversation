import{d as t,c as e,o as a,w as s,a as i,t as n,r as l,b as o,F as c,e as r,f as d,B as u,A as m,E as h,g,l as p,h as y,i as v,j as _,k as f,m as k,n as w,p as C,q as b}from"./vendor.d7d25305.js";!function(t=".",e="__import__"){try{self[e]=new Function("u","return import(u)")}catch(a){const s=new URL(t,location),i=t=>{URL.revokeObjectURL(t.src),t.remove()};self[e]=t=>new Promise(((a,n)=>{const l=new URL(t,s);if(self[e].moduleMap[l])return a(self[e].moduleMap[l]);const o=new Blob([`import * as m from '${l}';`,`${e}.moduleMap['${l}']=m;`],{type:"text/javascript"}),c=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(o),onerror(){n(new Error(`Failed to import: ${t}`)),i(c)},onload(){a(self[e].moduleMap[l]),i(c)}});document.head.appendChild(c)})),self[e].moduleMap={}}}("assets/");const x=t({props:{data:{type:Object,default:()=>({cmd:"",text:""})}}}),S=i("a",null,"HomeAssistant",-1);x.render=function(t,o,c,r,d,u){const m=l("a-avatar"),h=l("a-comment");return a(),e(h,null,{author:s((()=>[S])),avatar:s((()=>[i(m,{src:"https://www.home-assistant.io/images/home-assistant-logo.svg",alt:"HomeAssistant"})])),content:s((()=>[i("p",null,n(t.data.text),1)])),_:1})};var M=t({props:{data:Object}});const $=o("第一集"),O=o("第二集"),A=o("第一集"),V=o("第一集"),j=o("第一集"),L=o("第一集"),U=o("第一集"),E=o("第一集");M.render=function(t,n,o,c,r,d){const u=l("a-card-grid"),m=l("a-card");return a(),e(m,{title:"我想看司藤",size:"small"},{default:s((()=>[i(m,{title:"获取所有状态值"},{default:s((()=>[i(u,{style:{width:"25%","text-align":"center"}},{default:s((()=>[$])),_:1}),i(u,{style:{width:"25%","text-align":"center"}},{default:s((()=>[O])),_:1}),i(u,{style:{width:"25%","text-align":"center"}},{default:s((()=>[A])),_:1}),i(u,{style:{width:"25%","text-align":"center"}},{default:s((()=>[V])),_:1}),i(u,{style:{width:"25%","text-align":"center"}},{default:s((()=>[j])),_:1}),i(u,{style:{width:"25%","text-align":"center"}},{default:s((()=>[L])),_:1}),i(u,{style:{width:"25%","text-align":"center"}},{default:s((()=>[U])),_:1}),i(u,{style:{width:"25%","text-align":"center"}},{default:s((()=>[E])),_:1})])),_:1})])),_:1})};const T={props:{data:{type:Object,default:()=>({domain:"",value:"",entity_id:"",isAction:!1})}},data:()=>({}),inject:["callService"],methods:{toggleClick(){const{value:t,domain:e,entity_id:a}=this.data;this.callService(`${e}.turn_${"on"===t?"off":"on"}`,{entity_id:a}),this.$message.success("切换成功"),this.$emit("toggle")},triggerClick(){const{domain:t,entity_id:e}=this.data;"script"===t?this.callService(e):"automation"===t&&this.callService("automation.trigger",{entity_id:e}),this.$message.success("触发成功"),this.$emit("trigger")},sourceListChange(t){const{domain:e,entity_id:a}=this.data;this.callService("media_player.select_source",{entity_id:a,source:t}),this.$message.success(`选择【${t}】`)},format_source_list:t=>t.map((t=>({value:t,label:t})))}},P=o("触发"),R={key:3};T.render=function(t,i,o,c,r,d){const u=l("a-switch"),m=l("a-button"),h=l("a-select");return o.data.isAction&&["input_boolean","light","switch","fan","automation","climate"].includes(o.data.domain)?(a(),e(u,{key:0,checked:"on"===o.data.value,onClick:d.toggleClick},null,8,["checked","onClick"])):o.data.isAction&&["script","scene","automation"].includes(o.data.domain)?(a(),e(m,{key:1,type:"link",onClick:d.triggerClick},{default:s((()=>[P])),_:1},8,["onClick"])):"source_list"===o.data.name?(a(),e(h,{key:2,style:{width:"200px"},options:d.format_source_list(o.data.value),onChange:d.sourceListChange},null,8,["options","onChange"])):(a(),e("span",R,n(o.data.value),1))};var B=t({components:{ActionButton:T},props:{data:{type:Object,default:()=>({cmd:"",text:"",list:[]})},hass:{},load:Function},data:()=>({list:[],entity:null}),inject:["callService"],async mounted(){const t=this.data.list;if(this.list=await this.load({entity_list:t}),1===t.length){const e=t[0].split(".")[0];"media_player"===e&&(this.entity={domain:e,entity_id:t[0],volume_level:100*this.list.find((t=>"volume_level"===t.name)).value})}},methods:{toggleClick(t){t.value="on"===t.value?"off":"on"},musicEvent({service:t}){const{entity_id:e,volume_level:a}=this.entity;let s={entity_id:e};"volume_set"===t&&(s.volume_level=a/100),this.callService(`media_player.${t}`,s),this.$message.success("操作成功")}}});const F={key:0,style:{"text-align":"center"}},H=o("上一曲"),J=o("播放/暂停"),K=o("下一曲");B.render=function(t,u,m,h,g,p){const y=l("a-button"),v=l("a-space"),_=l("a-slider"),f=l("ActionButton"),k=l("a-list-item"),w=l("a-list");return a(),e(c,null,[t.entity?(a(),e(c,{key:0},["media_player"===t.entity.domain?(a(),e("div",F,[i(v,null,{default:s((()=>[i(y,{type:"primary",onClick:u[1]||(u[1]=e=>t.musicEvent({service:"media_previous_track"}))},{default:s((()=>[H])),_:1}),i(y,{type:"primary",onClick:u[2]||(u[2]=e=>t.musicEvent({service:"media_play_pause"}))},{default:s((()=>[J])),_:1}),i(y,{type:"primary",onClick:u[3]||(u[3]=e=>t.musicEvent({service:"media_next_track"}))},{default:s((()=>[K])),_:1})])),_:1}),i(_,{value:t.entity.volume_level,"onUpdate:value":u[4]||(u[4]=e=>t.entity.volume_level=e),onAfterChange:u[5]||(u[5]=e=>t.musicEvent({service:"volume_set"}))},null,8,["value"])])):r("",!0)],64)):r("",!0),i(w,{bordered:""},{default:s((()=>[(a(!0),e(c,null,d(t.list,((l,c)=>(a(),e(k,{key:c},{actions:s((()=>[i(f,{data:l,onToggle:e=>t.toggleClick(l)},null,8,["data","onToggle"])])),default:s((()=>[o(n(l.name)+" ",1)])),_:2},1024)))),128))])),_:1})],64)};const N={},z={style:{"text-align":"center",padding:"50px"}};N.render=function(t,s){const n=l("a-spin");return a(),e("div",z,[i(n,{size:"large"})])};var I=t({components:{BarsOutlined:u,AudioOutlined:m,EditOutlined:h,CardMessage:x,CardVideo:M,CardState:B,CardLoading:N},setup:()=>({hass:null,list:g([]),isVoice:g(!1)}),data(){return{msg:"",loading:!1,throttle:p.throttle((()=>{this.sendMsg(this.msg)}),2e3,{leading:!1,trailing:!0})}},watch:{msg(t){t&&this.isVoice&&this.throttle()}},provide(){return{callService:this.callService}},created(){this.connect()},methods:{async connect(){let t;try{t=await y({loadTokens(){try{return JSON.parse(localStorage.hassTokens)}catch(t){}},saveTokens:t=>{localStorage.hassTokens=JSON.stringify(t)}})}catch(a){if(a!==v)return void alert(`Unknown error: ${a}`);{const e=prompt("请输入要连接的HomeAssistant地址?",location.origin);t=await y({hassUrl:e})}}const e=await _({auth:t});location.search.includes("auth_callback=1")&&history.replaceState(null,"",location.pathname),this.hass=e,f(e).then((t=>{console.log("Logged in as",t),e.sendMessagePromise({type:"get_states"}).then((e=>{let a=e.find((t=>"conversation.voice"===t.entity_id)),s=new URLSearchParams(location.search),i=a.attributes.version;s.get("ver")!=i?location.search=`?ver=${i}`:this.list.push({name:"CardMessage",cmd:"HomeAssistant服务连接成功",data:{text:`【${t.name}】你好，欢迎使用语音小助手，当前版本${i}`}})}))}))},async callService(t,e={}){let a=t.split(".");const s=await this.hass.sendMessagePromise({type:"call_service",domain:a[0],service:a[1],service_data:e});return console.log(s),s},async loadData({entity_list:t}){await this.sleep(1);const e=(await this.hass.sendMessagePromise({type:"get_states"})).filter((e=>t.includes(e.entity_id))).map((t=>(t.domain=t.entity_id.split(".")[0],t)));let a=[];if(1===e.length){const{attributes:t,state:s,domain:i,entity_id:n}=e[0];a=Object.keys(t).map((e=>({domain:i,entity_id:n,name:e,value:t[e]}))),a.unshift({domain:i,entity_id:n,name:t.friendly_name,value:s,isAction:!0})}else a=e.map((t=>({domain:t.domain,entity_id:t.entity_id,name:t.attributes.friendly_name,value:t.state,isAction:!0})));return a},scrollIntoView(){setTimeout((()=>{const t=document.querySelector("#app .ant-card:nth-last-child(2)");t&&t.scrollIntoView({behavior:"smooth"})}),500)},sendMsgKeydown(t){const{msg:e,isVoice:a}=this;e&&!a&&this.sendMsg(e)},sleep:async t=>new Promise((e=>{setTimeout(e,1e3*t)})),sendMsg(t){this.msg="";const e={name:"CardLoading",cmd:t,data:{text:"",list:[]}};this.list.push(e),this.loading=!0,this.hass.sendMessagePromise({conversation_id:`${Math.random().toString(16).substr(2,10)}${Math.random().toString(16).substr(2,10)}`,text:t,type:"conversation/process"}).then((({speech:t})=>{e.data.text=t.plain.speech;const a=t.plain.extra_data;if(a){const t=a.data;e.name="CardState",e.data.list=t}else e.name="CardMessage";this.list[this.list.length-1]=JSON.parse(JSON.stringify(e))})).finally((()=>{this.loading=!1})),this.scrollIntoView()},toggleVoiceClick(){this.isVoice=!this.isVoice}}});const q={style:{position:"fixed",bottom:"0",left:"0",width:"100%",padding:"10px",background:"white"}};I.render=function(t,n,o,r,u,m){const h=l("a-card"),g=l("BarsOutlined"),p=l("AudioOutlined"),y=l("EditOutlined"),v=l("a-tooltip"),_=l("a-input");return a(),e(c,null,[(a(!0),e(c,null,d(t.list,((i,n)=>(a(),e(h,{size:"small",key:n,title:i.cmd},{default:s((()=>[(a(),e(w(i.name),{data:i.data,hass:t.hass,load:t.loadData},null,8,["data","hass","load"]))])),_:2},1032,["title"])))),128)),i("div",q,[i(_,{placeholder:"请输入文字命令",value:t.msg,"onUpdate:value":n[2]||(n[2]=e=>t.msg=e),valueModifiers:{trim:!0},onKeydown:k(t.sendMsgKeydown,["enter"]),disabled:t.loading},{prefix:s((()=>[i(g,{type:"user"})])),suffix:s((()=>[i(v,{title:t.isVoice?"自动发送":"手动发送"},{default:s((()=>[i("span",{onClick:n[1]||(n[1]=(...e)=>t.toggleVoiceClick&&t.toggleVoiceClick(...e))},[t.isVoice?(a(),e(p,{key:0,style:{color:"rgba(0, 0, 0, 0.45)"}})):(a(),e(y,{key:1,style:{color:"rgba(0, 0, 0, 0.45)"}}))])])),_:1},8,["title"])])),_:1},8,["value","onKeydown","disabled"])])],64)};C(I).use(b).mount("#app");

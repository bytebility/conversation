import{d as t,c as e,r as a,o as s,w as n,a as o,t as i,b as l,e as r,B as c,A as d,E as u,l as h,g as m,f as g,h as p,i as f,F as y,j as w,k as _,m as v,n as k}from"./vendor.463f5676.js";!function(t=".",e="__import__"){try{self[e]=new Function("u","return import(u)")}catch(a){const s=new URL(t,location),n=t=>{URL.revokeObjectURL(t.src),t.remove()};self[e]=t=>new Promise(((a,o)=>{const i=new URL(t,s);if(self[e].moduleMap[i])return a(self[e].moduleMap[i]);const l=new Blob([`import * as m from '${i}';`,`${e}.moduleMap['${i}']=m;`],{type:"text/javascript"}),r=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(l),onerror(){o(new Error(`Failed to import: ${t}`)),n(r)},onload(){a(self[e].moduleMap[i]),n(r)}});document.head.appendChild(r)})),self[e].moduleMap={}}}("assets/");const x=t({props:{data:{type:Object,default:()=>({cmd:"",text:""})}}}),M=o("a",null,"HomeAssistant",-1);x.render=function(t,l,r,c,d,u){const h=a("a-avatar"),m=a("a-comment"),g=a("a-card");return s(),e(g,{size:"small",title:t.data.cmd},{default:n((()=>[o(m,null,{author:n((()=>[M])),avatar:n((()=>[o(h,{src:"https://www.home-assistant.io/images/home-assistant-logo.svg",alt:"HomeAssistant"})])),content:n((()=>[o("p",null,i(t.data.text),1)])),_:1})])),_:1},8,["title"])};var b=t({props:{data:Object}});const O=l("第一集"),C=l("第二集"),U=l("第一集"),S=l("第一集"),V=l("第一集"),$=l("第一集"),j=l("第一集"),L=l("第一集");b.render=function(t,i,l,r,c,d){const u=a("a-card-grid"),h=a("a-card");return s(),e(h,{title:"我想看司藤",size:"small"},{default:n((()=>[o(h,{title:"获取所有状态值"},{default:n((()=>[o(u,{style:{width:"25%","text-align":"center"}},{default:n((()=>[O])),_:1}),o(u,{style:{width:"25%","text-align":"center"}},{default:n((()=>[C])),_:1}),o(u,{style:{width:"25%","text-align":"center"}},{default:n((()=>[U])),_:1}),o(u,{style:{width:"25%","text-align":"center"}},{default:n((()=>[S])),_:1}),o(u,{style:{width:"25%","text-align":"center"}},{default:n((()=>[V])),_:1}),o(u,{style:{width:"25%","text-align":"center"}},{default:n((()=>[$])),_:1}),o(u,{style:{width:"25%","text-align":"center"}},{default:n((()=>[j])),_:1}),o(u,{style:{width:"25%","text-align":"center"}},{default:n((()=>[L])),_:1})])),_:1})])),_:1})};var A=t({props:{data:{}},setup:()=>({checked:r(!1)})});const R=l("测试"),E=l("测试 "),B=l(" 10 "),H=l("测试 ");A.render=function(t,i,l,r,c,d){const u=a("a-list-item"),h=a("a-switch"),m=a("a-list"),g=a("a-card");return s(),e(g,{title:"我想看司藤"},{default:n((()=>[o(m,{bordered:""},{default:n((()=>[o(u,null,{default:n((()=>[R])),_:1}),o(u,null,{actions:n((()=>[B])),default:n((()=>[E])),_:1}),o(u,null,{actions:n((()=>[o(h,{checked:t.checked,"onUpdate:checked":i[1]||(i[1]=e=>t.checked=e)},null,8,["checked"])])),default:n((()=>[H])),_:1})])),_:1})])),_:1})};var P=t({components:{BarsOutlined:c,AudioOutlined:d,EditOutlined:u,CardMessage:x,CardVideo:b,CardState:A},setup:()=>({hass:null,list:r([]),isVoice:r(!1)}),data(){return{msg:"",throttle:h.throttle((()=>{this.sendMsg(this.msg)}),2e3,{leading:!1,trailing:!0})}},created(){this.connect()},methods:{async connect(){let t;try{t=await m({loadTokens(){try{return JSON.parse(localStorage.hassTokens)}catch(t){}},saveTokens:t=>{localStorage.hassTokens=JSON.stringify(t)}})}catch(a){if(a!==g)return void alert(`Unknown error: ${a}`);{const e=prompt("请输入要连接的HomeAssistant地址?",location.origin);t=await m({hassUrl:e})}}const e=await p({auth:t});location.search.includes("auth_callback=1")&&history.replaceState(null,"",location.pathname),this.hass=e,f(e).then((t=>{console.log("Logged in as",t),e.sendMessagePromise({type:"get_states"}).then((e=>{let a=e.find((t=>"conversation.voice"===t.entity_id)),s=new URLSearchParams(location.search),n=a.attributes.version;s.get("ver")!=n?location.search=`?ver=${n}`:this.list.push({name:"CardMessage",data:{cmd:"HomeAssistant服务连接成功",text:`【${t.name}】你好，欢迎使用语音小助手`}})}))}))},sendMsgKeydown(t){const{msg:e,isVoice:a}=this;if(e)return a?this.throttle():void(13===t.keyCode&&this.sendMsg(e))},sendMsg(t){this.msg="",this.hass.sendMessagePromise({conversation_id:`${Math.random().toString(16).substr(2,10)}${Math.random().toString(16).substr(2,10)}`,text:t,type:"conversation/process"}).then((({speech:e})=>{const a={cmd:String(t),text:e.plain.speech};this.list.push({name:"CardMessage",data:a})}))},toggleVoiceClick(){this.isVoice=!this.isVoice}}});const T={style:{position:"fixed",bottom:"0",left:"0",width:"100%",padding:"10px",background:"white"}};P.render=function(t,i,l,r,c,d){const u=a("BarsOutlined"),h=a("AudioOutlined"),m=a("EditOutlined"),g=a("a-tooltip"),p=a("a-input");return s(),e(y,null,[(s(!0),e(y,null,w(t.list,((t,a)=>(s(),e(_(t.name),{key:a,data:t.data},null,8,["data"])))),128)),o("div",T,[o(p,{placeholder:"请输入文字命令",value:t.msg,"onUpdate:value":i[2]||(i[2]=e=>t.msg=e),onKeydown:i[3]||(i[3]=e=>t.sendMsgKeydown(e))},{prefix:n((()=>[o(u,{type:"user"})])),suffix:n((()=>[o(g,{title:t.isVoice?"自动发送":"手动发送"},{default:n((()=>[o("span",{onClick:i[1]||(i[1]=(...e)=>t.toggleVoiceClick&&t.toggleVoiceClick(...e))},[t.isVoice?(s(),e(h,{key:0,style:{color:"rgba(0, 0, 0, 0.45)"}})):(s(),e(m,{key:1,style:{color:"rgba(0, 0, 0, 0.45)"}}))])])),_:1},8,["title"])])),_:1},8,["value"])])],64)};v(P).use(k).mount("#app");

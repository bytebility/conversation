import{d as t,c as e,o as a,w as s,a as i,t as n,r as o,b as l,F as d,e as r,B as c,A as u,E as m,f as h,l as g,g as p,h as y,i as f,j as v,k as _,m as w,n as k,p as b}from"./vendor.5bffe6bd.js";!function(t=".",e="__import__"){try{self[e]=new Function("u","return import(u)")}catch(a){const s=new URL(t,location),i=t=>{URL.revokeObjectURL(t.src),t.remove()};self[e]=t=>new Promise(((a,n)=>{const o=new URL(t,s);if(self[e].moduleMap[o])return a(self[e].moduleMap[o]);const l=new Blob([`import * as m from '${o}';`,`${e}.moduleMap['${o}']=m;`],{type:"text/javascript"}),d=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(l),onerror(){n(new Error(`Failed to import: ${t}`)),i(d)},onload(){a(self[e].moduleMap[o]),i(d)}});document.head.appendChild(d)})),self[e].moduleMap={}}}("assets/");const C=t({props:{data:{type:Object,default:()=>({cmd:"",text:""})}}}),x=i("a",null,"HomeAssistant",-1);C.render=function(t,l,d,r,c,u){const m=o("a-avatar"),h=o("a-comment");return a(),e(h,null,{author:s((()=>[x])),avatar:s((()=>[i(m,{src:"https://www.home-assistant.io/images/home-assistant-logo.svg",alt:"HomeAssistant"})])),content:s((()=>[i("p",null,n(t.data.text),1)])),_:1})};var M=t({props:{data:Object}});const S=l("第一集"),O=l("第二集"),$=l("第一集"),j=l("第一集"),A=l("第一集"),V=l("第一集"),L=l("第一集"),U=l("第一集");M.render=function(t,n,l,d,r,c){const u=o("a-card-grid"),m=o("a-card");return a(),e(m,{title:"我想看司藤",size:"small"},{default:s((()=>[i(m,{title:"获取所有状态值"},{default:s((()=>[i(u,{style:{width:"25%","text-align":"center"}},{default:s((()=>[S])),_:1}),i(u,{style:{width:"25%","text-align":"center"}},{default:s((()=>[O])),_:1}),i(u,{style:{width:"25%","text-align":"center"}},{default:s((()=>[$])),_:1}),i(u,{style:{width:"25%","text-align":"center"}},{default:s((()=>[j])),_:1}),i(u,{style:{width:"25%","text-align":"center"}},{default:s((()=>[A])),_:1}),i(u,{style:{width:"25%","text-align":"center"}},{default:s((()=>[V])),_:1}),i(u,{style:{width:"25%","text-align":"center"}},{default:s((()=>[L])),_:1}),i(u,{style:{width:"25%","text-align":"center"}},{default:s((()=>[U])),_:1})])),_:1})])),_:1})};const T={props:{data:{type:Object,default:()=>({domain:"",value:"",entity_id:""})}},data:()=>({}),inject:["callService"],methods:{toggleClick(){this.$emit("toggle");const{value:t,domain:e,entity_id:a}=data;this.callService(`${e}.turn_${"on"===t?"off":"on"}`,{entity_id:a}),this.$message.success("切换成功")},triggerClick(){this.$emit("trigger");const{domain:t,entity_id:e}=data;"script"===t?this.callService(e):"automation"===t&&this.callService("automation.trigger",{entity_id:e}),this.$message.success("触发成功")}}},B=l("触发"),R={key:2};T.render=function(t,i,l,d,r,c){const u=o("a-switch"),m=o("a-button");return["input_boolean","light","switch","fan","automation","climate"].includes(l.data.domain)?(a(),e(u,{key:0,checked:"on"===l.data.value,onClick:c.toggleClick},null,8,["checked","onClick"])):["script","scene","automation"].includes(l.data.domain)?(a(),e(m,{key:1,type:"link",onClick:c.triggerClick},{default:s((()=>[B])),_:1},8,["onClick"])):(a(),e("span",R,n(l.data.value),1))};var P=t({components:{ActionButton:T},props:{data:{type:Object,default:()=>({cmd:"",text:"",list:[]})},hass:{},load:Function},data:()=>({list:[]}),async mounted(){this.list=await this.load({entity_list:this.data.list})},methods:{toggleClick(t){t.value="on"===t.value?"off":"on"}}});P.render=function(t,c,u,m,h,g){const p=o("ActionButton"),y=o("a-list-item"),f=o("a-list");return a(),e(f,{bordered:""},{default:s((()=>[(a(!0),e(d,null,r(t.list,((o,d)=>(a(),e(y,{key:d},{actions:s((()=>[i(p,{data:o,onToggle:e=>t.toggleClick(o)},null,8,["data","onToggle"])])),default:s((()=>[l(n(o.name)+" ",1)])),_:2},1024)))),128))])),_:1})};var E=t({components:{ActionButton:T},props:{data:{type:Object,default:()=>({cmd:"",text:"",list:[]})},hass:{},load:Function},data:()=>({list:[]}),async mounted(){this.list=await this.load({entity_list:this.data.list})},methods:{toggleClick(t){t.value="on"===t.value?"off":"on"}}});E.render=function(t,c,u,m,h,g){const p=o("ActionButton"),y=o("a-list-item"),f=o("a-list");return a(),e(f,{bordered:""},{default:s((()=>[(a(!0),e(d,null,r(t.list,((o,d)=>(a(),e(y,{key:d},{actions:s((()=>[i(p,{data:o,onToggle:e=>t.toggleClick(o)},null,8,["data","onToggle"])])),default:s((()=>[l(n(o.name)+" ",1)])),_:2},1024)))),128))])),_:1})};const F={},H={style:{"text-align":"center",padding:"50px"}};F.render=function(t,s){const n=o("a-spin");return a(),e("div",H,[i(n,{size:"large"})])};var J=t({components:{BarsOutlined:c,AudioOutlined:u,CardAttributes:E,EditOutlined:m,CardMessage:C,CardVideo:M,CardState:P,CardLoading:F},setup:()=>({hass:null,list:h([]),isVoice:h(!1)}),data(){return{msg:"",loading:!1,throttle:g.throttle((()=>{this.sendMsg(this.msg)}),2e3,{leading:!1,trailing:!0})}},watch:{msg(t){t&&this.isVoice&&this.throttle()}},provide(){return{callService:this.callService}},created(){this.connect()},methods:{async connect(){let t;try{t=await p({loadTokens(){try{return JSON.parse(localStorage.hassTokens)}catch(t){}},saveTokens:t=>{localStorage.hassTokens=JSON.stringify(t)}})}catch(a){if(a!==y)return void alert(`Unknown error: ${a}`);{const e=prompt("请输入要连接的HomeAssistant地址?",location.origin);t=await p({hassUrl:e})}}const e=await f({auth:t});location.search.includes("auth_callback=1")&&history.replaceState(null,"",location.pathname),this.hass=e,v(e).then((t=>{console.log("Logged in as",t),e.sendMessagePromise({type:"get_states"}).then((e=>{let a=e.find((t=>"conversation.voice"===t.entity_id)),s=new URLSearchParams(location.search),i=a.attributes.version;s.get("ver")!=i?location.search=`?ver=${i}`:this.list.push({name:"CardMessage",cmd:"HomeAssistant服务连接成功",data:{text:`【${t.name}】你好，欢迎使用语音小助手，当前版本${i}`}})}))}))},async callService(t,e={}){let a=t.split(".");const s=await this.hass.sendMessagePromise({type:"call_service",domain:a[0],service:a[1],service_data:e});return console.log(s),s},async loadData({entity_list:t}){const e=(await this.hass.sendMessagePromise({type:"get_states"})).filter((e=>t.includes(e.entity_id))).map((t=>(t.domain=t.entity_id.split(".")[0],t)));let a=[];if(1===e.length){const{attributes:t,state:s,domain:i,entity_id:n}=e[0];a=Object.keys(t).map((e=>({name:e,value:t[e]}))),a.unshift({domain:i,entity_id:n,name:t.friendly_name,value:s})}else a=e.map((t=>({domain:t.domain,entity_id:t.entity_id,name:t.attributes.friendly_name,value:t.state})));return a},scrollIntoView(){setTimeout((()=>{const t=document.querySelector("#app .ant-card:nth-last-child(2)");t&&t.scrollIntoView({behavior:"smooth"})}),500)},sendMsgKeydown(t){const{msg:e}=this;e&&this.sendMsg(e)},sendMsg(t){this.msg="";const e={name:"CardLoading",cmd:t,data:{text:"",list:[]}};this.list.push(e),this.loading=!0,this.hass.sendMessagePromise({conversation_id:`${Math.random().toString(16).substr(2,10)}${Math.random().toString(16).substr(2,10)}`,text:t,type:"conversation/process"}).then((({speech:t})=>{e.data.text=t.plain.speech;const a=t.plain.extra_data;if(a){const t=a.data;t.length>1?e.name="CardState":e.name="CardAttributes",e.data.list=t}else e.name="CardMessage";this.list[this.list.length-1]=JSON.parse(JSON.stringify(e))})).finally((()=>{this.loading=!1})),this.scrollIntoView()},toggleVoiceClick(){this.isVoice=!this.isVoice}}});const K={style:{position:"fixed",bottom:"0",left:"0",width:"100%",padding:"10px",background:"white"}};J.render=function(t,n,l,c,u,m){const h=o("a-card"),g=o("BarsOutlined"),p=o("AudioOutlined"),y=o("EditOutlined"),f=o("a-tooltip"),v=o("a-input");return a(),e(d,null,[(a(!0),e(d,null,r(t.list,((i,n)=>(a(),e(h,{size:"small",key:n,title:i.cmd},{default:s((()=>[(a(),e(w(i.name),{data:i.data,hass:t.hass,load:t.loadData},null,8,["data","hass","load"]))])),_:2},1032,["title"])))),128)),i("div",K,[i(v,{placeholder:"请输入文字命令",value:t.msg,"onUpdate:value":n[2]||(n[2]=e=>t.msg=e),valueModifiers:{trim:!0},onKeydown:_(t.sendMsgKeydown,["enter"]),disabled:t.loading},{prefix:s((()=>[i(g,{type:"user"})])),suffix:s((()=>[i(f,{title:t.isVoice?"自动发送":"手动发送"},{default:s((()=>[i("span",{onClick:n[1]||(n[1]=(...e)=>t.toggleVoiceClick&&t.toggleVoiceClick(...e))},[t.isVoice?(a(),e(p,{key:0,style:{color:"rgba(0, 0, 0, 0.45)"}})):(a(),e(y,{key:1,style:{color:"rgba(0, 0, 0, 0.45)"}}))])])),_:1},8,["title"])])),_:1},8,["value","onKeydown","disabled"])])],64)};k(J).use(b).mount("#app");
